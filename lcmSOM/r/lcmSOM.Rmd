Self Organizing Maps: Ciera LCM 
========================================================

The goal of this analysis is to find genes that have co-expression patterns of 

1. curated leaf gene list. Mean, Rep,
2. most differentiated genes between tissue. 

##Required Libraries

```{r}
library(ggplot2)
library(reshape)
library(kohonen)
```

##1.pca.R

First read in file that came from mostSigDEgenes.Rmd.  This is a list of genes from all DE analysis in WT. They were all cancatenated, then duplicate genes were removed.  In addition the mean was calculated from the replicates of each type. 

The first step is to get it into the right format. First column being the genes, while the subsequent columns are the different libraries (type).

```{r}
mostDEgenes <- read.csv("../data/allGeneList.csv")
mostDEgenes <- mostDEgenes[c(7, 1, 4)] #keep only needed columns (gene, type, mean)
summary(mostDEgenes)
head(mostDEgenes)


#Change from long to wide data format
mostDEgene.long <- cast(mostDEgenes, gene ~ type, value.var = mean, fun.aggregate = "mean")  #why did I have to specify "mean" here? Are there duplicates of types? Double check later. 

mostDEgene.long <- as.data.frame(mostDEgene.long) #or does not keep column names during transformation. 
names(mostDEgene.long)

scale_data <- as.matrix(t(scale(t(mostDEgene.long[c(2:7)])))) 

head(scale_data)

#Principle Component Analysis
pca <- prcomp(scale_data, scale=TRUE) 

summary(pca) 
pca.scores <- data.frame(pca$x)

data.val <- cbind(mostDEgene.long, scale_data, pca.scores) 
head(data.val)
```


##Visualizing the PCA

Looks to be 2 maybe three major clusters. 

```{r}
p <- ggplot(data.val, aes(PC1, PC2))
p + geom_point()
```

##1. Self Organizing Map

This was the first attempt.  It appears as thought there is not enough information for the clustering 
```{r}
names(data.val)

som.data <- as.matrix(data.val[,c(6:11)]) 

head(som.data)

set.seed(3)

som <- som(data=som.data, somgrid(3,3,"hexagonal"))
summary(som)

plot(som, type ="changes")
plot(som, type = "codes")
plot(som, type = "counts")
plot(som, type = "quality")

data.val <- cbind(sig.tissue,sc.m82,sc.penn,ssom$unit.classif, ssom$distances) #this doesn't find sig.tissue
head(data.val)
```


